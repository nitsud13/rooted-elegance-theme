{{ 'base.css' | asset_url | stylesheet_tag }}

{% paginate search.results by section.settings.products_per_page %}
<section class="main-search section" data-section-id="{{ section.id }}">
  <div class="container">
    <!-- Search Header -->
    <header class="search-header">
      <h1 class="search-title">
        {% if search.performed %}
          {% if search.results_count > 0 %}
            Search results for "{{ search.terms | escape }}"
          {% else %}
            No results found for "{{ search.terms | escape }}"
          {% endif %}
        {% else %}
          Search
        {% endif %}
      </h1>
      {% if search.performed %}
        <span class="search-count">
          {{ search.results_count }} {{ search.results_count | pluralize: 'result', 'results' }}
        </span>
      {% endif %}
    </header>

    <!-- Search Form -->
    <div class="search-form-wrapper">
      <form action="{{ routes.search_url }}" method="get" class="search-page-form" role="search">
        <label for="search-page-input" class="visually-hidden">Search our store</label>
        <div class="search-page-input-wrapper">
          <svg class="search-page-icon" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
          <input
            type="search"
            id="search-page-input"
            name="q"
            class="search-page-input"
            placeholder="Search for trees, shrubs, and more..."
            value="{{ search.terms | escape }}"
            autocomplete="off"
            autocorrect="off"
            autocapitalize="off"
            spellcheck="false"
          >
          <button type="submit" class="search-page-submit btn btn--primary">
            Search
          </button>
        </div>
      </form>
    </div>

    {% if search.performed and search.results_count > 0 %}
      <!-- Toolbar -->
      <div class="search-toolbar">
        <div class="toolbar-left">
          <span class="results-info">
            Showing {{ paginate.current_offset | plus: 1 }}-{{ paginate.current_offset | plus: paginate.page_size | at_most: search.results_count }} of {{ search.results_count }}
          </span>
        </div>

        <div class="toolbar-right">
          {% if section.settings.enable_sorting %}
            <div class="sort-wrapper">
              <label for="search-sort-select" class="sr-only">Sort by</label>
              <select id="search-sort-select" class="sort-select" onchange="sortSearch(this.value)">
                <option value="relevance" {% if search.sort_by == 'relevance' %}selected{% endif %}>Relevance</option>
                <option value="price-ascending" {% if search.sort_by == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
                <option value="price-descending" {% if search.sort_by == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
                <option value="created-descending" {% if search.sort_by == 'created-descending' %}selected{% endif %}>Newest</option>
              </select>
              <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Search Results Grid -->
      <div class="search-grid" id="search-grid">
        {% for item in search.results %}
          {% if item.object_type == 'product' %}
            {% render 'product-card', product: item, show_zone_badge: true, show_quick_add: true %}
          {% elsif item.object_type == 'article' %}
            <article class="search-article-card">
              <a href="{{ item.url }}" class="search-article-link">
                {% if item.image %}
                  <div class="search-article-image">
                    <img
                      src="{{ item.image | image_url: width: 600 }}"
                      alt="{{ item.title | escape }}"
                      loading="lazy"
                    >
                  </div>
                {% endif %}
                <div class="search-article-content">
                  <span class="search-article-type">Article</span>
                  <h3 class="search-article-title">{{ item.title }}</h3>
                  <p class="search-article-excerpt">{{ item.excerpt_or_content | strip_html | truncate: 150 }}</p>
                </div>
              </a>
            </article>
          {% elsif item.object_type == 'page' %}
            <article class="search-page-card">
              <a href="{{ item.url }}" class="search-page-link">
                <div class="search-page-content">
                  <span class="search-page-type">Page</span>
                  <h3 class="search-page-title">{{ item.title }}</h3>
                  <p class="search-page-excerpt">{{ item.content | strip_html | truncate: 150 }}</p>
                </div>
              </a>
            </article>
          {% endif %}
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if paginate.pages > 1 %}
        <nav class="pagination" aria-label="Search pagination">
          {% if paginate.previous %}
            <a href="{{ paginate.previous.url }}" class="pagination-btn pagination-prev">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"/>
              </svg>
              Previous
            </a>
          {% endif %}

          <span class="pagination-info">
            Page {{ paginate.current_page }} of {{ paginate.pages }}
          </span>

          {% if paginate.next %}
            <a href="{{ paginate.next.url }}" class="pagination-btn pagination-next">
              Next
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="9 18 15 12 9 6"/>
              </svg>
            </a>
          {% endif %}
        </nav>
      {% endif %}

    {% elsif search.performed %}
      <!-- No Results -->
      <div class="search-empty">
        <div class="search-empty-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            <line x1="8" y1="11" x2="14" y2="11"/>
          </svg>
        </div>
        <h2 class="search-empty-title">No results found</h2>
        <p class="search-empty-message">
          We couldn't find any results for "{{ search.terms | escape }}". Try adjusting your search or browse our collections.
        </p>
        <div class="search-empty-suggestions">
          <h3 class="search-suggestions-title">Popular searches</h3>
          <div class="search-suggestions-links">
            <a href="{{ routes.search_url }}?q=maple" class="search-suggestion-link">Maple Trees</a>
            <a href="{{ routes.search_url }}?q=oak" class="search-suggestion-link">Oak Trees</a>
            <a href="{{ routes.search_url }}?q=evergreen" class="search-suggestion-link">Evergreen</a>
            <a href="{{ routes.search_url }}?q=fruit" class="search-suggestion-link">Fruit Trees</a>
          </div>
        </div>
        <a href="{{ routes.collections_url }}" class="btn btn--primary btn--lg">
          Browse All Collections
        </a>
      </div>
    {% else %}
      <!-- Search Not Performed -->
      <div class="search-prompt">
        <div class="search-prompt-icon">
          <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="11" cy="11" r="8"/>
            <line x1="21" y1="21" x2="16.65" y2="16.65"/>
          </svg>
        </div>
        <h2 class="search-prompt-title">Find the perfect tree for your yard</h2>
        <p class="search-prompt-message">
          Search for trees, shrubs, and plants by name, zone, or type
        </p>
      </div>
    {% endif %}
  </div>
</section>
{% endpaginate %}

<script>
  function sortSearch(sortBy) {
    const url = new URL(window.location.href);
    url.searchParams.set('sort_by', sortBy);
    window.location.href = url.toString();
  }
</script>

<style>
  .main-search {
    padding: var(--space-8) 0 var(--space-24);
  }

  /* Search Header */
  .search-header {
    text-align: center;
    margin-bottom: var(--space-8);
  }

  .search-title {
    font-family: var(--font-heading);
    font-size: var(--text-3xl);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    margin-bottom: var(--space-2);
    animation: fadeInUp var(--duration-slow) var(--ease-out) both;
  }

  @media (min-width: 768px) {
    .search-title {
      font-size: var(--text-4xl);
    }
  }

  .search-count {
    font-size: var(--text-base);
    color: var(--color-bark-light);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    animation: fadeInUp var(--duration-slow) var(--ease-out) 100ms both;
  }

  /* Search Form */
  .search-form-wrapper {
    max-width: 700px;
    margin: 0 auto var(--space-10);
    animation: fadeInUp var(--duration-slow) var(--ease-out) 150ms both;
  }

  .search-page-input-wrapper {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-2);
    background: var(--color-white);
    border: 2px solid var(--color-cream-warm);
    border-radius: var(--radius-full);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .search-page-input-wrapper:focus-within {
    border-color: var(--color-forest);
    box-shadow: 0 0 0 4px rgba(27, 77, 62, 0.1);
  }

  .search-page-icon {
    margin-left: var(--space-4);
    color: var(--color-sage);
    flex-shrink: 0;
  }

  .search-page-input {
    flex: 1;
    padding: var(--space-3) var(--space-2);
    font-family: var(--font-body);
    font-size: var(--text-lg);
    color: var(--color-bark);
    background: transparent;
    border: none;
    outline: none;
  }

  .search-page-input::placeholder {
    color: var(--color-bark-light);
  }

  .search-page-submit {
    flex-shrink: 0;
    padding: var(--space-3) var(--space-6);
    border-radius: var(--radius-full);
  }

  @media (max-width: 640px) {
    .search-page-input-wrapper {
      flex-wrap: wrap;
      border-radius: var(--radius-xl);
      padding: var(--space-3);
    }

    .search-page-icon {
      margin-left: var(--space-2);
    }

    .search-page-input {
      width: 100%;
      padding: var(--space-2);
    }

    .search-page-submit {
      width: 100%;
      margin-top: var(--space-2);
    }
  }

  /* Toolbar */
  .search-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-8);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-cream-warm);
    animation: fadeInUp var(--duration-slow) var(--ease-out) 200ms both;
  }

  .results-info {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
  }

  .sort-wrapper {
    position: relative;
  }

  .sort-select {
    appearance: none;
    padding: var(--space-3) var(--space-10) var(--space-3) var(--space-4);
    font-family: var(--font-body);
    font-size: var(--text-sm);
    color: var(--color-bark);
    background: var(--color-white);
    border: 2px solid var(--color-cream-warm);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .sort-select:hover,
  .sort-select:focus {
    border-color: var(--color-forest);
    outline: none;
  }

  .sort-icon {
    position: absolute;
    right: var(--space-3);
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    color: var(--color-bark-light);
  }

  /* Search Grid */
  .search-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-6);
    animation: fadeInUp var(--duration-slow) var(--ease-out) 250ms both;
  }

  @media (min-width: 768px) {
    .search-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .search-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-8);
    }
  }

  /* Article Card */
  .search-article-card {
    background: var(--color-white);
    border-radius: var(--radius-xl);
    overflow: hidden;
    transition: all var(--duration-normal) var(--ease-out);
  }

  .search-article-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-4px);
  }

  .search-article-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .search-article-image {
    aspect-ratio: 16/9;
    overflow: hidden;
    background: var(--color-cream-warm);
  }

  .search-article-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform var(--duration-slow) var(--ease-out);
  }

  .search-article-card:hover .search-article-image img {
    transform: scale(1.05);
  }

  .search-article-content {
    padding: var(--space-5);
  }

  .search-article-type {
    display: inline-block;
    padding: var(--space-1) var(--space-3);
    font-size: 10px;
    font-weight: var(--weight-bold);
    letter-spacing: var(--tracking-wider);
    text-transform: uppercase;
    color: var(--color-forest);
    background: var(--color-sage-light);
    border-radius: var(--radius-full);
    margin-bottom: var(--space-3);
  }

  .search-article-title {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    margin-bottom: var(--space-2);
    line-height: var(--leading-snug);
    transition: color var(--duration-fast);
  }

  .search-article-card:hover .search-article-title {
    color: var(--color-earth);
  }

  .search-article-excerpt {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
    line-height: var(--leading-relaxed);
    margin: 0;
  }

  /* Page Card */
  .search-page-card {
    background: var(--color-white);
    border-radius: var(--radius-xl);
    overflow: hidden;
    transition: all var(--duration-normal) var(--ease-out);
  }

  .search-page-card:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-4px);
  }

  .search-page-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .search-page-content {
    padding: var(--space-6);
  }

  .search-page-type {
    display: inline-block;
    padding: var(--space-1) var(--space-3);
    font-size: 10px;
    font-weight: var(--weight-bold);
    letter-spacing: var(--tracking-wider);
    text-transform: uppercase;
    color: var(--color-white);
    background: var(--color-bark);
    border-radius: var(--radius-full);
    margin-bottom: var(--space-3);
  }

  .search-page-title {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    margin-bottom: var(--space-2);
    line-height: var(--leading-snug);
    transition: color var(--duration-fast);
  }

  .search-page-card:hover .search-page-title {
    color: var(--color-earth);
  }

  .search-page-excerpt {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
    line-height: var(--leading-relaxed);
    margin: 0;
  }

  /* Pagination */
  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    margin-top: var(--space-16);
    padding-top: var(--space-8);
    border-top: 1px solid var(--color-cream-warm);
  }

  .pagination-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-5);
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    background: var(--color-white);
    border-radius: var(--radius-full);
    text-decoration: none;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .pagination-btn:hover {
    background: var(--color-forest);
    color: var(--color-white);
  }

  .pagination-info {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
  }

  /* Empty State */
  .search-empty {
    text-align: center;
    padding: var(--space-16) var(--space-6);
    animation: fadeInUp var(--duration-slow) var(--ease-out) both;
  }

  .search-empty-icon {
    margin-bottom: var(--space-6);
    color: var(--color-sage);
    opacity: 0.5;
  }

  .search-empty-title {
    font-family: var(--font-heading);
    font-size: var(--text-3xl);
    color: var(--color-forest);
    margin-bottom: var(--space-4);
  }

  .search-empty-message {
    font-size: var(--text-lg);
    color: var(--color-bark-light);
    margin-bottom: var(--space-8);
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
  }

  .search-empty-suggestions {
    margin-bottom: var(--space-10);
  }

  .search-suggestions-title {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    margin-bottom: var(--space-4);
  }

  .search-suggestions-links {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--space-3);
  }

  .search-suggestion-link {
    display: inline-block;
    padding: var(--space-2) var(--space-4);
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    background: var(--color-cream);
    border: 2px solid var(--color-cream-warm);
    border-radius: var(--radius-full);
    text-decoration: none;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .search-suggestion-link:hover {
    background: var(--color-forest);
    border-color: var(--color-forest);
    color: var(--color-white);
  }

  /* Search Prompt (before search) */
  .search-prompt {
    text-align: center;
    padding: var(--space-16) var(--space-6);
    animation: fadeInUp var(--duration-slow) var(--ease-out) both;
  }

  .search-prompt-icon {
    margin-bottom: var(--space-6);
    color: var(--color-sage);
  }

  .search-prompt-title {
    font-family: var(--font-heading);
    font-size: var(--text-2xl);
    color: var(--color-forest);
    margin-bottom: var(--space-3);
  }

  .search-prompt-message {
    font-size: var(--text-lg);
    color: var(--color-bark-light);
    max-width: 400px;
    margin: 0 auto;
  }

  /* Animation */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Mobile Responsive */
  @media (max-width: 767px) {
    .main-search {
      padding: var(--space-6) 0 var(--space-16);
    }

    .search-toolbar {
      flex-direction: column;
      gap: var(--space-3);
      align-items: stretch;
    }

    .results-info {
      text-align: center;
    }

    .sort-wrapper {
      width: 100%;
    }

    .sort-select {
      width: 100%;
    }
  }
</style>

{% schema %}
{
  "name": "Search Results",
  "tag": "section",
  "class": "main-search-section",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Results per page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 24
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable sorting",
      "default": true
    },
    {
      "type": "select",
      "id": "grid_columns",
      "label": "Grid columns (desktop)",
      "options": [
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" },
        { "value": "5", "label": "5" }
      ],
      "default": "4"
    }
  ]
}
{% endschema %}
