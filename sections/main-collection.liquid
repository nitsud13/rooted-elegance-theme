{{ 'base.css' | asset_url | stylesheet_tag }}

<section class="main-collection section" data-section-id="{{ section.id }}">
  <div class="container">
    <!-- Collection Header -->
    <header class="collection-header">
      {% if collection.image %}
        <div class="collection-hero">
          <img
            src="{{ collection.image | image_url: width: 1600 }}"
            alt="{{ collection.title | escape }}"
            class="collection-hero-image"
            loading="eager"
          >
          <div class="collection-hero-overlay"></div>
          <div class="collection-hero-content">
            <h1 class="collection-title">{{ collection.title }}</h1>
            {% if collection.description != blank %}
              <div class="collection-description">{{ collection.description }}</div>
            {% endif %}
            <span class="collection-count">{{ collection.products_count }} {{ collection.products_count | pluralize: 'product', 'products' }}</span>
          </div>
        </div>
      {% else %}
        <div class="collection-header-simple">
          <h1 class="collection-title">{{ collection.title }}</h1>
          {% if collection.description != blank %}
            <div class="collection-description">{{ collection.description }}</div>
          {% endif %}
          <span class="collection-count">{{ collection.products_count }} {{ collection.products_count | pluralize: 'product', 'products' }}</span>
        </div>
      {% endif %}
    </header>

    {% if collection.products.size > 0 %}
      <!-- Toolbar -->
      <div class="collection-toolbar">
        <div class="toolbar-left">
          {% if section.settings.enable_filtering %}
            <button type="button" class="filter-toggle btn btn--ghost btn--sm" onclick="toggleFilters()">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="4" y1="21" x2="4" y2="14"/>
                <line x1="4" y1="10" x2="4" y2="3"/>
                <line x1="12" y1="21" x2="12" y2="12"/>
                <line x1="12" y1="8" x2="12" y2="3"/>
                <line x1="20" y1="21" x2="20" y2="16"/>
                <line x1="20" y1="12" x2="20" y2="3"/>
                <line x1="1" y1="14" x2="7" y2="14"/>
                <line x1="9" y1="8" x2="15" y2="8"/>
                <line x1="17" y1="16" x2="23" y2="16"/>
              </svg>
              Filters
            </button>
          {% endif %}
        </div>

        <div class="toolbar-right">
          {% if section.settings.enable_sorting %}
            <div class="sort-wrapper">
              <label for="sort-select" class="sr-only">Sort by</label>
              <select id="sort-select" class="sort-select" onchange="sortCollection(this.value)">
                <option value="manual" {% if collection.sort_by == 'manual' %}selected{% endif %}>Featured</option>
                <option value="best-selling" {% if collection.sort_by == 'best-selling' %}selected{% endif %}>Best Selling</option>
                <option value="title-ascending" {% if collection.sort_by == 'title-ascending' %}selected{% endif %}>A-Z</option>
                <option value="title-descending" {% if collection.sort_by == 'title-descending' %}selected{% endif %}>Z-A</option>
                <option value="price-ascending" {% if collection.sort_by == 'price-ascending' %}selected{% endif %}>Price: Low to High</option>
                <option value="price-descending" {% if collection.sort_by == 'price-descending' %}selected{% endif %}>Price: High to Low</option>
                <option value="created-descending" {% if collection.sort_by == 'created-descending' %}selected{% endif %}>Newest</option>
              </select>
              <svg class="sort-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"/>
              </svg>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Zone Filter Panel -->
      <div class="zone-filter-panel" id="zone-filter-panel" hidden>
        <div class="zone-filter-panel__inner">
          <div class="zone-filter-panel__header">
            <h3 class="zone-filter-panel__title">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <path d="M12 6v6l4 2"/>
              </svg>
              Filter by Growing Zone
            </h3>
            <button type="button" class="zone-filter-panel__close" onclick="closeFilterPanel()" aria-label="Close filter panel">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>

          <div class="zone-filter-panel__content">
            <!-- Saved Zone Display -->
            <div class="zone-filter-panel__saved" id="saved-zone-display" hidden>
              <span class="zone-filter-panel__saved-label">Your zone:</span>
              <span class="zone-filter-panel__saved-zone" id="saved-zone-value">Zone 7</span>
              <button type="button" class="zone-filter-panel__change" onclick="showZoneInput()">Change</button>
            </div>

            <!-- Zone Input -->
            <div class="zone-filter-panel__input-group" id="zone-input-group">
              <label for="filter-zip-input" class="zone-filter-panel__label">Enter your ZIP code to find your growing zone:</label>
              <div class="zone-filter-panel__input-wrapper">
                <input
                  type="text"
                  id="filter-zip-input"
                  class="zone-filter-panel__input"
                  placeholder="Enter ZIP code"
                  maxlength="5"
                  pattern="[0-9]{5}"
                >
                <button type="button" class="zone-filter-panel__lookup btn btn--primary btn--sm" onclick="lookupZoneFromFilter()">
                  Find Zone
                </button>
              </div>
            </div>

            <!-- Quick Zone Buttons -->
            <div class="zone-filter-panel__quick">
              <span class="zone-filter-panel__quick-label">Or select zone directly:</span>
              <div class="zone-filter-panel__zone-buttons">
                {% for i in (3..11) %}
                  <button type="button" class="zone-filter-panel__zone-btn" data-zone="{{ i }}" onclick="setFilterZone({{ i }})">
                    {{ i }}
                  </button>
                {% endfor %}
              </div>
            </div>
          </div>

          <div class="zone-filter-panel__actions">
            <button type="button" class="btn btn--primary" onclick="applyZoneFilter()" id="apply-filter-btn" disabled>
              Apply Filter
            </button>
            <button type="button" class="btn btn--ghost" onclick="clearZoneFilter()">
              Clear Filter
            </button>
          </div>
        </div>
      </div>

      <!-- Filter Status Bar -->
      <div class="filter-status" id="filter-status" hidden>
        <span class="filter-status__text">
          Showing <strong id="visible-count">0</strong> of <strong id="total-count">0</strong> products compatible with <strong id="active-zone-display">Zone 7</strong>
        </span>
        <button type="button" class="filter-status__clear" onclick="clearZoneFilter()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
          Clear filter
        </button>
      </div>

      <!-- Products Grid -->
      <div class="collection-grid" id="product-grid">
        {% for product in collection.products %}
          {% render 'product-card', product: product, show_zone_badge: true, show_quick_add: true %}
        {% endfor %}
      </div>

      <!-- Pagination -->
      {% if paginate.pages > 1 %}
        {% paginate collection.products by section.settings.products_per_page %}
          <nav class="pagination" aria-label="Pagination">
            {% if paginate.previous %}
              <a href="{{ paginate.previous.url }}" class="pagination-btn pagination-prev">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="15 18 9 12 15 6"/>
                </svg>
                Previous
              </a>
            {% endif %}

            <span class="pagination-info">
              Page {{ paginate.current_page }} of {{ paginate.pages }}
            </span>

            {% if paginate.next %}
              <a href="{{ paginate.next.url }}" class="pagination-btn pagination-next">
                Next
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="9 18 15 12 9 6"/>
                </svg>
              </a>
            {% endif %}
          </nav>
        {% endpaginate %}
      {% endif %}

    {% else %}
      <!-- Empty Collection -->
      <div class="collection-empty">
        <div class="collection-empty-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
            <path d="M2 17l10 5 10-5"/>
            <path d="M2 12l10 5 10-5"/>
          </svg>
        </div>
        <h2 class="collection-empty-title">No products found</h2>
        <p class="collection-empty-message">This collection doesn't have any products yet. Check back soon!</p>
        <a href="{{ routes.collections_url }}" class="btn btn--primary btn--lg">
          Browse All Collections
        </a>
      </div>
    {% endif %}
  </div>
</section>

<script>
  // Collection Zone Filter Module
  const CollectionFilter = {
    selectedZone: null,
    isFilterActive: false,

    init() {
      // Check for saved zone on load
      const savedZone = this.getSavedZone();
      if (savedZone) {
        this.selectedZone = parseInt(savedZone.zone);
        this.updateSavedZoneDisplay(savedZone);
      }

      // Check if filter was active in session
      if (sessionStorage.getItem('zone_filter_active') === 'true') {
        const zone = sessionStorage.getItem('zone_filter_zone');
        if (zone) {
          this.selectedZone = parseInt(zone);
          this.applyFilter();
        }
      }

      // Listen for zone changes from other components
      document.addEventListener('zone:changed', (e) => {
        if (e.detail && e.detail.zone) {
          this.selectedZone = parseInt(e.detail.zone);
          this.updateSavedZoneDisplay({ zone: e.detail.zone });
          if (this.isFilterActive) {
            this.applyFilter();
          }
        }
      });

      // Update total count
      const productGrid = document.getElementById('product-grid');
      const totalProducts = productGrid ? productGrid.querySelectorAll('.product-card').length : 0;
      document.getElementById('total-count').textContent = totalProducts;
    },

    getSavedZone() {
      try {
        const saved = localStorage.getItem('rooted_elegance_zone');
        return saved ? JSON.parse(saved) : null;
      } catch (e) {
        return null;
      }
    },

    updateSavedZoneDisplay(zoneData) {
      const savedDisplay = document.getElementById('saved-zone-display');
      const savedValue = document.getElementById('saved-zone-value');
      const inputGroup = document.getElementById('zone-input-group');

      if (zoneData && zoneData.zone) {
        savedValue.textContent = `Zone ${zoneData.zone}`;
        savedDisplay.hidden = false;
        inputGroup.hidden = true;
        this.enableApplyButton();
        this.highlightZoneButton(zoneData.zone);
      } else {
        savedDisplay.hidden = true;
        inputGroup.hidden = false;
      }
    },

    highlightZoneButton(zone) {
      document.querySelectorAll('.zone-filter-panel__zone-btn').forEach(btn => {
        btn.classList.remove('active');
        if (parseInt(btn.dataset.zone) === parseInt(zone)) {
          btn.classList.add('active');
        }
      });
    },

    enableApplyButton() {
      const applyBtn = document.getElementById('apply-filter-btn');
      applyBtn.disabled = false;
    },

    applyFilter() {
      if (!this.selectedZone) return;

      const productGrid = document.getElementById('product-grid');
      const products = productGrid.querySelectorAll('.product-card');
      let visibleCount = 0;
      const totalCount = products.length;

      products.forEach(card => {
        const zonesAttr = card.dataset.productZone;
        if (!zonesAttr) {
          // No zone data - hide by default when filtering
          card.classList.add('zone-hidden');
          return;
        }

        const zones = zonesAttr.split(',').map(z => parseInt(z.trim()));
        const isCompatible = zones.includes(this.selectedZone);

        if (isCompatible) {
          card.classList.remove('zone-hidden');
          visibleCount++;
        } else {
          card.classList.add('zone-hidden');
        }
      });

      // Update UI
      this.isFilterActive = true;
      document.getElementById('visible-count').textContent = visibleCount;
      document.getElementById('total-count').textContent = totalCount;
      document.getElementById('active-zone-display').textContent = `Zone ${this.selectedZone}`;
      document.getElementById('filter-status').hidden = false;
      document.querySelector('.filter-toggle').classList.add('filter-active');

      // Persist filter state in session
      sessionStorage.setItem('zone_filter_active', 'true');
      sessionStorage.setItem('zone_filter_zone', this.selectedZone.toString());

      // Close panel
      this.closePanel();
    },

    clearFilter() {
      const productGrid = document.getElementById('product-grid');
      const products = productGrid.querySelectorAll('.product-card');

      products.forEach(card => {
        card.classList.remove('zone-hidden');
      });

      // Update UI
      this.isFilterActive = false;
      document.getElementById('filter-status').hidden = true;
      document.querySelector('.filter-toggle').classList.remove('filter-active');

      // Clear session storage
      sessionStorage.removeItem('zone_filter_active');
      sessionStorage.removeItem('zone_filter_zone');

      this.closePanel();
    },

    openPanel() {
      document.getElementById('zone-filter-panel').hidden = false;
      document.body.classList.add('filter-panel-open');
    },

    closePanel() {
      document.getElementById('zone-filter-panel').hidden = true;
      document.body.classList.remove('filter-panel-open');
    },

    lookupZone() {
      const zipInput = document.getElementById('filter-zip-input');
      const zip = zipInput.value.trim();

      if (!/^\d{5}$/.test(zip)) {
        zipInput.classList.add('error');
        return;
      }

      zipInput.classList.remove('error');

      // Use the ZoneSelector API if available
      if (window.ZoneSelector && window.ZoneSelector.getZoneFromZip) {
        const result = window.ZoneSelector.getZoneFromZip(zip);
        if (result && result.zone) {
          this.selectedZone = parseInt(result.zone);
          this.highlightZoneButton(result.zone);
          this.enableApplyButton();

          // Save to localStorage
          localStorage.setItem('rooted_elegance_zone', JSON.stringify({
            zone: result.zone,
            zip: zip,
            timestamp: Date.now()
          }));

          this.updateSavedZoneDisplay({ zone: result.zone });
        }
      }
    },

    setZone(zone) {
      this.selectedZone = parseInt(zone);
      this.highlightZoneButton(zone);
      this.enableApplyButton();
    }
  };

  // Global functions for onclick handlers
  function toggleFilters() {
    CollectionFilter.openPanel();
  }

  function closeFilterPanel() {
    CollectionFilter.closePanel();
  }

  function applyZoneFilter() {
    CollectionFilter.applyFilter();
  }

  function clearZoneFilter() {
    CollectionFilter.clearFilter();
  }

  function lookupZoneFromFilter() {
    CollectionFilter.lookupZone();
  }

  function setFilterZone(zone) {
    CollectionFilter.setZone(zone);
  }

  function showZoneInput() {
    document.getElementById('saved-zone-display').hidden = true;
    document.getElementById('zone-input-group').hidden = false;
  }

  function sortCollection(sortBy) {
    const url = new URL(window.location.href);
    url.searchParams.set('sort_by', sortBy);
    window.location.href = url.toString();
  }

  function addToCart(variantId, quantity) {
    fetch('/cart/add.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        id: variantId,
        quantity: quantity
      })
    })
    .then(response => response.json())
    .then(data => {
      // Dispatch cart updated event
      document.dispatchEvent(new CustomEvent('cart:updated', { detail: data }));
    })
    .catch(error => {
      console.error('Error:', error);
    });
  }

  // Initialize on DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    CollectionFilter.init();
  });
</script>

<style>
  .main-collection {
    padding-bottom: var(--space-24);
  }

  /* Collection Header */
  .collection-hero {
    position: relative;
    height: 300px;
    border-radius: var(--radius-2xl);
    overflow: hidden;
    margin-bottom: var(--space-10);
  }

  @media (min-width: 768px) {
    .collection-hero {
      height: 400px;
    }
  }

  .collection-hero-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .collection-hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(27, 77, 62, 0.9), rgba(27, 77, 62, 0.4));
  }

  .collection-hero-content {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: var(--space-8);
    color: var(--color-white);
  }

  .collection-header-simple {
    text-align: center;
    padding: var(--space-12) 0;
    margin-bottom: var(--space-8);
  }

  .collection-title {
    font-family: var(--font-heading);
    font-size: var(--text-4xl);
    font-weight: var(--weight-medium);
    margin-bottom: var(--space-4);
    animation: fadeInUp var(--duration-slow) var(--ease-out) both;
  }

  .collection-hero .collection-title {
    color: var(--color-white);
  }

  .collection-header-simple .collection-title {
    color: var(--color-forest);
  }

  .collection-description {
    font-size: var(--text-lg);
    opacity: 0.9;
    max-width: 600px;
    margin-bottom: var(--space-4);
    animation: fadeInUp var(--duration-slow) var(--ease-out) 100ms both;
  }

  .collection-hero .collection-description {
    color: rgba(255, 255, 255, 0.9);
  }

  .collection-header-simple .collection-description {
    color: var(--color-bark-light);
    margin-left: auto;
    margin-right: auto;
  }

  .collection-count {
    font-size: var(--text-sm);
    text-transform: uppercase;
    letter-spacing: var(--tracking-wider);
    opacity: 0.7;
    animation: fadeInUp var(--duration-slow) var(--ease-out) 200ms both;
  }

  /* Toolbar */
  .collection-toolbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-8);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-cream-warm);
  }

  .sort-wrapper {
    position: relative;
  }

  .sort-select {
    appearance: none;
    padding: var(--space-3) var(--space-10) var(--space-3) var(--space-4);
    font-family: var(--font-body);
    font-size: var(--text-sm);
    color: var(--color-bark);
    background: var(--color-white);
    border: 2px solid var(--color-cream-warm);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .sort-select:hover,
  .sort-select:focus {
    border-color: var(--color-forest);
    outline: none;
  }

  .sort-icon {
    position: absolute;
    right: var(--space-3);
    top: 50%;
    transform: translateY(-50%);
    pointer-events: none;
    color: var(--color-bark-light);
  }

  /* Products Grid */
  .collection-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-6);
  }

  @media (min-width: 768px) {
    .collection-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .collection-grid {
      grid-template-columns: repeat(4, 1fr);
      gap: var(--space-8);
    }
  }

  /* Product Card */
  .product-card {
    position: relative;
  }

  .product-card-link {
    display: block;
    text-decoration: none;
    color: inherit;
  }

  .product-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-sage);
    background: var(--color-cream-warm);
  }

  .product-badges {
    position: absolute;
    top: var(--space-3);
    left: var(--space-3);
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
    z-index: 10;
  }

  .quick-add-btn {
    position: absolute;
    bottom: var(--space-3);
    right: var(--space-3);
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--color-white);
    border: none;
    border-radius: var(--radius-full);
    box-shadow: var(--shadow-md);
    cursor: pointer;
    opacity: 0;
    transform: translateY(10px);
    transition: all var(--duration-normal) var(--ease-out);
    z-index: 10;
  }

  .product-card:hover .quick-add-btn {
    opacity: 1;
    transform: translateY(0);
  }

  .quick-add-btn:hover {
    background: var(--color-earth);
    color: var(--color-white);
  }

  .product-title {
    font-family: var(--font-heading);
    font-size: var(--text-base);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    margin-bottom: var(--space-2);
    line-height: var(--leading-snug);
  }

  .product-price {
    display: flex;
    align-items: baseline;
    gap: var(--space-2);
    margin-top: var(--space-2);
  }

  .price-compare {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
    text-decoration: line-through;
  }

  .price-current {
    font-size: var(--text-lg);
    font-weight: var(--weight-semibold);
    color: var(--color-forest);
  }

  .price-sale {
    color: var(--color-earth);
  }

  /* Pagination */
  .pagination {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-4);
    margin-top: var(--space-16);
    padding-top: var(--space-8);
    border-top: 1px solid var(--color-cream-warm);
  }

  .pagination-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-5);
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--color-forest);
    background: var(--color-white);
    border-radius: var(--radius-full);
    text-decoration: none;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .pagination-btn:hover {
    background: var(--color-forest);
    color: var(--color-white);
  }

  .pagination-info {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
  }

  /* Empty Collection */
  .collection-empty {
    text-align: center;
    padding: var(--space-20) var(--space-6);
  }

  .collection-empty-icon {
    margin-bottom: var(--space-6);
    color: var(--color-sage);
    opacity: 0.5;
  }

  .collection-empty-title {
    font-family: var(--font-heading);
    font-size: var(--text-3xl);
    color: var(--color-forest);
    margin-bottom: var(--space-4);
  }

  .collection-empty-message {
    font-size: var(--text-lg);
    color: var(--color-bark-light);
    margin-bottom: var(--space-8);
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }

  /* Zone Filter Panel */
  .zone-filter-panel {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    width: 100%;
    max-width: 420px;
    background: var(--color-white);
    box-shadow: -4px 0 30px rgba(27, 77, 62, 0.15);
    z-index: 1000;
    transform: translateX(0);
    animation: slideInRight 0.3s var(--ease-out);
  }

  .zone-filter-panel[hidden] {
    display: none;
  }

  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .zone-filter-panel__inner {
    display: flex;
    flex-direction: column;
    height: 100%;
    padding: var(--space-6);
  }

  .zone-filter-panel__header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: var(--space-5);
    border-bottom: 2px solid var(--color-cream-warm);
    margin-bottom: var(--space-6);
  }

  .zone-filter-panel__title {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    font-weight: var(--weight-semibold);
    color: var(--color-forest);
    margin: 0;
  }

  .zone-filter-panel__title svg {
    color: var(--color-sage);
  }

  .zone-filter-panel__close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: var(--color-cream-warm);
    border: none;
    border-radius: var(--radius-full);
    cursor: pointer;
    color: var(--color-bark);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .zone-filter-panel__close:hover {
    background: var(--color-forest);
    color: var(--color-white);
  }

  .zone-filter-panel__content {
    flex: 1;
    overflow-y: auto;
  }

  /* Saved Zone Display */
  .zone-filter-panel__saved {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    background: linear-gradient(135deg, var(--color-sage-light), rgba(139, 168, 136, 0.3));
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-6);
  }

  .zone-filter-panel__saved-label {
    font-size: var(--text-sm);
    color: var(--color-bark);
  }

  .zone-filter-panel__saved-zone {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    font-weight: var(--weight-semibold);
    color: var(--color-forest);
  }

  .zone-filter-panel__change {
    margin-left: auto;
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--color-earth);
    background: none;
    border: none;
    cursor: pointer;
    text-decoration: underline;
    transition: color var(--duration-fast);
  }

  .zone-filter-panel__change:hover {
    color: var(--color-forest);
  }

  /* Zone Input Group */
  .zone-filter-panel__input-group {
    margin-bottom: var(--space-6);
  }

  .zone-filter-panel__label {
    display: block;
    font-size: var(--text-sm);
    color: var(--color-bark);
    margin-bottom: var(--space-3);
  }

  .zone-filter-panel__input-wrapper {
    display: flex;
    gap: var(--space-3);
  }

  .zone-filter-panel__input {
    flex: 1;
    padding: var(--space-3) var(--space-4);
    font-family: var(--font-body);
    font-size: var(--text-base);
    color: var(--color-bark);
    background: var(--color-white);
    border: 2px solid var(--color-cream-warm);
    border-radius: var(--radius-lg);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .zone-filter-panel__input:focus {
    outline: none;
    border-color: var(--color-forest);
  }

  .zone-filter-panel__input.error {
    border-color: var(--color-earth);
    animation: shake 0.3s ease-in-out;
  }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
  }

  .zone-filter-panel__lookup {
    white-space: nowrap;
  }

  /* Quick Zone Buttons */
  .zone-filter-panel__quick {
    margin-bottom: var(--space-6);
  }

  .zone-filter-panel__quick-label {
    display: block;
    font-size: var(--text-sm);
    color: var(--color-bark-light);
    margin-bottom: var(--space-3);
  }

  .zone-filter-panel__zone-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-2);
  }

  .zone-filter-panel__zone-btn {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-heading);
    font-size: var(--text-base);
    font-weight: var(--weight-semibold);
    color: var(--color-bark);
    background: var(--color-cream);
    border: 2px solid var(--color-cream-warm);
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all var(--duration-fast) var(--ease-out);
  }

  .zone-filter-panel__zone-btn:hover {
    border-color: var(--color-forest);
    color: var(--color-forest);
  }

  .zone-filter-panel__zone-btn.active {
    background: var(--color-forest);
    border-color: var(--color-forest);
    color: var(--color-white);
    transform: scale(1.05);
  }

  /* Panel Actions */
  .zone-filter-panel__actions {
    display: flex;
    gap: var(--space-3);
    padding-top: var(--space-5);
    border-top: 2px solid var(--color-cream-warm);
    margin-top: auto;
  }

  .zone-filter-panel__actions .btn {
    flex: 1;
  }

  .zone-filter-panel__actions .btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  /* Filter Status Bar */
  .filter-status {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--space-4) var(--space-5);
    background: linear-gradient(135deg, var(--color-sage-light), rgba(139, 168, 136, 0.2));
    border-radius: var(--radius-lg);
    margin-bottom: var(--space-6);
    animation: fadeIn 0.3s var(--ease-out);
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .filter-status__text {
    font-size: var(--text-sm);
    color: var(--color-bark);
  }

  .filter-status__text strong {
    color: var(--color-forest);
    font-weight: var(--weight-semibold);
  }

  .filter-status__clear {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--color-earth);
    background: none;
    border: none;
    cursor: pointer;
    transition: color var(--duration-fast);
  }

  .filter-status__clear:hover {
    color: var(--color-forest);
  }

  /* Filter Toggle Active State */
  .filter-toggle.filter-active {
    background: var(--color-forest);
    color: var(--color-white);
    border-color: var(--color-forest);
  }

  .filter-toggle.filter-active:hover {
    background: var(--color-forest-dark);
  }

  /* Product Card Hidden State */
  .product-card.zone-hidden {
    display: none;
    animation: fadeOut 0.3s var(--ease-out);
  }

  @keyframes fadeOut {
    from { opacity: 1; transform: scale(1); }
    to { opacity: 0; transform: scale(0.95); }
  }

  /* Overlay when panel is open */
  body.filter-panel-open::after {
    content: '';
    position: fixed;
    inset: 0;
    background: rgba(27, 77, 62, 0.3);
    z-index: 999;
    animation: fadeIn 0.3s var(--ease-out);
  }

  /* Mobile Responsive */
  @media (max-width: 767px) {
    .zone-filter-panel {
      max-width: 100%;
    }

    .zone-filter-panel__inner {
      padding: var(--space-5);
    }

    .zone-filter-panel__zone-btn {
      width: 40px;
      height: 40px;
      font-size: var(--text-sm);
    }

    .filter-status {
      flex-direction: column;
      gap: var(--space-3);
      text-align: center;
    }

    .filter-status__clear {
      width: 100%;
      justify-content: center;
      padding: var(--space-2);
      background: var(--color-white);
      border-radius: var(--radius-md);
    }
  }
</style>

{% schema %}
{
  "name": "Collection",
  "tag": "section",
  "class": "main-collection-section",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products per page",
      "min": 8,
      "max": 48,
      "step": 4,
      "default": 16
    },
    {
      "type": "checkbox",
      "id": "enable_sorting",
      "label": "Enable sorting",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable filtering",
      "default": true
    },
    {
      "type": "select",
      "id": "grid_columns",
      "label": "Grid columns (desktop)",
      "options": [
        { "value": "3", "label": "3" },
        { "value": "4", "label": "4" },
        { "value": "5", "label": "5" }
      ],
      "default": "4"
    }
  ]
}
{% endschema %}
