
<section class="main-cart section" data-section-id="{{ section.id }}">
  <div class="container">
    <header class="cart-header">
      <h1 class="cart-title">{{ section.settings.title }}</h1>
      {% if cart.item_count > 0 %}
        <span class="cart-count">{{ cart.item_count }} {{ cart.item_count | pluralize: 'item', 'items' }}</span>
      {% endif %}
    </header>

    {% if cart.item_count > 0 %}
      <form action="{{ routes.cart_url }}" method="post" class="cart-form">
        <div class="cart-layout">
          <!-- Cart Items -->
          <div class="cart-items">
            {% for item in cart.items %}
              <div class="cart-item" data-line-item="{{ forloop.index }}">
                <div class="cart-item-image">
                  {% if item.image %}
                    <img
                      src="{{ item.image | image_url: width: 200 }}"
                      alt="{{ item.title | escape }}"
                      loading="lazy"
                    >
                  {% else %}
                    <div class="cart-item-placeholder">
                      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                      </svg>
                    </div>
                  {% endif %}
                </div>

                <div class="cart-item-details">
                  <div class="cart-item-info">
                    <h3 class="cart-item-title">
                      <a href="{{ item.url }}">{{ item.product.title }}</a>
                    </h3>
                    {% unless item.product.has_only_default_variant %}
                      <p class="cart-item-variant">{{ item.variant.title }}</p>
                    {% endunless %}
                    {% if item.selling_plan_allocation %}
                      <p class="cart-item-subscription">{{ item.selling_plan_allocation.selling_plan.name }}</p>
                    {% endif %}
                  </div>

                  <div class="cart-item-quantity">
                    <label for="quantity-{{ forloop.index }}" class="sr-only">Quantity</label>
                    <div class="quantity-selector">
                      <button
                        type="button"
                        class="quantity-btn quantity-minus"
                        aria-label="Decrease quantity"
                        onclick="updateQuantity({{ forloop.index }}, {{ item.quantity | minus: 1 }})"
                      >
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                      </button>
                      <input
                        type="number"
                        id="quantity-{{ forloop.index }}"
                        name="updates[]"
                        value="{{ item.quantity }}"
                        min="0"
                        class="quantity-input"
                        aria-label="Quantity"
                      >
                      <button
                        type="button"
                        class="quantity-btn quantity-plus"
                        aria-label="Increase quantity"
                        onclick="updateQuantity({{ forloop.index }}, {{ item.quantity | plus: 1 }})"
                      >
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <line x1="12" y1="5" x2="12" y2="19"/>
                          <line x1="5" y1="12" x2="19" y2="12"/>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>

                <div class="cart-item-price">
                  {% if item.original_line_price != item.final_line_price %}
                    <span class="price-compare">{{ item.original_line_price | money }}</span>
                  {% endif %}
                  <span class="price-current">{{ item.final_line_price | money }}</span>
                </div>

                <button
                  type="button"
                  class="cart-item-remove"
                  aria-label="Remove {{ item.title }}"
                  onclick="updateQuantity({{ forloop.index }}, 0)"
                >
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"/>
                    <line x1="6" y1="6" x2="18" y2="18"/>
                  </svg>
                </button>
              </div>
            {% endfor %}
          </div>

          <!-- Cart Summary -->
          <div class="cart-summary">
            <div class="cart-summary-card">
              <h2 class="cart-summary-title">Order Summary</h2>

              <div class="cart-summary-rows">
                <div class="cart-summary-row">
                  <span>Subtotal</span>
                  <span>{{ cart.items_subtotal_price | money }}</span>
                </div>

                {% if cart.cart_level_discount_applications.size > 0 %}
                  {% for discount in cart.cart_level_discount_applications %}
                    <div class="cart-summary-row cart-summary-discount">
                      <span>{{ discount.title }}</span>
                      <span>-{{ discount.total_allocated_amount | money }}</span>
                    </div>
                  {% endfor %}
                {% endif %}

                <div class="cart-summary-row cart-summary-shipping">
                  <span>Shipping</span>
                  <span>Calculated at checkout</span>
                </div>
              </div>

              <div class="cart-summary-total">
                <span>Total</span>
                <span>{{ cart.total_price | money }}</span>
              </div>

              {% if section.settings.show_note %}
                <div class="cart-note">
                  <label for="cart-note" class="cart-note-label">Order Notes</label>
                  <textarea
                    id="cart-note"
                    name="note"
                    class="input cart-note-input"
                    placeholder="Special instructions for your order..."
                  >{{ cart.note }}</textarea>
                </div>
              {% endif %}

              <div class="cart-actions">
                <button type="submit" name="checkout" class="btn btn--primary btn--lg cart-checkout-btn">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                    <line x1="1" y1="10" x2="23" y2="10"/>
                  </svg>
                  Checkout
                </button>

                <noscript>
                  <button type="submit" name="update" class="btn btn--secondary">
                    Update Cart
                  </button>
                </noscript>

                <a href="{{ routes.all_products_collection_url }}" class="continue-shopping">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="12" x2="5" y2="12"/>
                    <polyline points="12 19 5 12 12 5"/>
                  </svg>
                  Continue Shopping
                </a>
              </div>

              {% if section.settings.show_trust_badges %}
                <div class="cart-trust">
                  <div class="trust-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                      <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
                    </svg>
                    <span>Secure Checkout</span>
                  </div>
                  <div class="trust-item">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                    </svg>
                    <span>1-Year Guarantee</span>
                  </div>
                </div>
              {% endif %}
            </div>
          </div>
        </div>
      </form>
    {% else %}
      <!-- Empty Cart -->
      <div class="cart-empty">
        <div class="cart-empty-icon">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <circle cx="9" cy="21" r="1"/>
            <circle cx="20" cy="21" r="1"/>
            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
          </svg>
        </div>
        <h2 class="cart-empty-title">{{ section.settings.empty_title }}</h2>
        <p class="cart-empty-message">{{ section.settings.empty_message }}</p>
        <a href="{{ routes.all_products_collection_url }}" class="btn btn--primary btn--lg">
          Start Shopping
        </a>
      </div>
    {% endif %}
  </div>
</section>

<script>
  function updateQuantity(line, quantity) {
    fetch('/cart/change.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        line: line,
        quantity: quantity
      })
    })
    .then(response => response.json())
    .then(() => {
      window.location.reload();
    });
  }
</script>

<style>
  .main-cart {
    padding: var(--space-12) 0 var(--space-24);
    min-height: 60vh;
  }

  .cart-header {
    display: flex;
    align-items: baseline;
    gap: var(--space-4);
    margin-bottom: var(--space-10);
    padding-bottom: var(--space-6);
    border-bottom: 2px solid var(--color-cream-warm);
  }

  .cart-title {
    font-family: var(--font-heading);
    font-size: var(--text-4xl);
    color: var(--color-forest);
  }

  .cart-count {
    font-size: var(--text-lg);
    color: var(--color-bark-light);
  }

  .cart-layout {
    display: grid;
    gap: var(--space-10);
  }

  @media (min-width: 1024px) {
    .cart-layout {
      grid-template-columns: 1fr 400px;
      align-items: start;
    }
  }

  /* Cart Items */
  .cart-items {
    display: flex;
    flex-direction: column;
    gap: var(--space-6);
  }

  .cart-item {
    display: grid;
    grid-template-columns: 100px 1fr auto auto;
    gap: var(--space-4);
    align-items: start;
    padding: var(--space-5);
    background: var(--color-white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-sm);
    transition: box-shadow var(--duration-normal) var(--ease-out);
  }

  .cart-item:hover {
    box-shadow: var(--shadow-md);
  }

  @media (max-width: 640px) {
    .cart-item {
      grid-template-columns: 80px 1fr auto;
      grid-template-rows: auto auto;
    }

    .cart-item-price {
      grid-column: 2;
      grid-row: 2;
    }

    .cart-item-remove {
      grid-column: 3;
      grid-row: 1;
    }
  }

  .cart-item-image {
    width: 100px;
    height: 100px;
    border-radius: var(--radius-lg);
    overflow: hidden;
    background: var(--color-cream-warm);
  }

  @media (max-width: 640px) {
    .cart-item-image {
      width: 80px;
      height: 80px;
    }
  }

  .cart-item-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .cart-item-placeholder {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--color-sage);
  }

  .cart-item-details {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
  }

  .cart-item-title {
    font-family: var(--font-heading);
    font-size: var(--text-lg);
    font-weight: var(--weight-medium);
  }

  .cart-item-title a {
    color: var(--color-forest);
    text-decoration: none;
    transition: color var(--duration-fast) var(--ease-out);
  }

  .cart-item-title a:hover {
    color: var(--color-earth);
  }

  .cart-item-variant,
  .cart-item-subscription {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
  }

  /* Quantity Selector */
  .quantity-selector {
    display: inline-flex;
    align-items: center;
    border: 2px solid var(--color-cream-warm);
    border-radius: var(--radius-full);
    overflow: hidden;
  }

  .quantity-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--color-bark);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .quantity-btn:hover {
    background: var(--color-cream-warm);
    color: var(--color-forest);
  }

  .quantity-input {
    width: 48px;
    height: 36px;
    text-align: center;
    font-family: var(--font-body);
    font-size: var(--text-base);
    font-weight: var(--weight-medium);
    border: none;
    background: transparent;
    -moz-appearance: textfield;
  }

  .quantity-input::-webkit-outer-spin-button,
  .quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  /* Price */
  .cart-item-price {
    text-align: right;
    min-width: 100px;
  }

  .price-compare {
    display: block;
    font-size: var(--text-sm);
    color: var(--color-bark-light);
    text-decoration: line-through;
  }

  .price-current {
    font-size: var(--text-lg);
    font-weight: var(--weight-semibold);
    color: var(--color-forest);
  }

  /* Remove Button */
  .cart-item-remove {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: transparent;
    border: none;
    border-radius: var(--radius-full);
    cursor: pointer;
    color: var(--color-bark-light);
    transition: all var(--duration-fast) var(--ease-out);
  }

  .cart-item-remove:hover {
    background: var(--color-error);
    color: var(--color-white);
  }

  /* Cart Summary */
  .cart-summary-card {
    background: var(--color-white);
    border-radius: var(--radius-xl);
    padding: var(--space-8);
    box-shadow: var(--shadow-md);
    position: sticky;
    top: var(--space-6);
  }

  .cart-summary-title {
    font-family: var(--font-heading);
    font-size: var(--text-xl);
    color: var(--color-forest);
    margin-bottom: var(--space-6);
    padding-bottom: var(--space-4);
    border-bottom: 1px solid var(--color-cream-warm);
  }

  .cart-summary-rows {
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    margin-bottom: var(--space-6);
  }

  .cart-summary-row {
    display: flex;
    justify-content: space-between;
    font-size: var(--text-base);
    color: var(--color-bark);
  }

  .cart-summary-discount {
    color: var(--color-success);
  }

  .cart-summary-shipping span:last-child {
    font-size: var(--text-sm);
    color: var(--color-bark-light);
  }

  .cart-summary-total {
    display: flex;
    justify-content: space-between;
    padding-top: var(--space-6);
    border-top: 2px solid var(--color-cream-warm);
    font-size: var(--text-xl);
    font-weight: var(--weight-semibold);
    color: var(--color-forest);
    margin-bottom: var(--space-6);
  }

  .cart-note {
    margin-bottom: var(--space-6);
  }

  .cart-note-label {
    display: block;
    font-size: var(--text-sm);
    font-weight: var(--weight-medium);
    color: var(--color-bark);
    margin-bottom: var(--space-2);
  }

  .cart-note-input {
    min-height: 80px;
    resize: vertical;
  }

  .cart-actions {
    display: flex;
    flex-direction: column;
    gap: var(--space-4);
  }

  .cart-checkout-btn {
    width: 100%;
  }

  .continue-shopping {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    font-size: var(--text-sm);
    color: var(--color-bark-light);
    text-decoration: none;
    transition: color var(--duration-fast) var(--ease-out);
  }

  .continue-shopping:hover {
    color: var(--color-forest);
  }

  .cart-trust {
    display: flex;
    justify-content: center;
    gap: var(--space-6);
    margin-top: var(--space-6);
    padding-top: var(--space-6);
    border-top: 1px solid var(--color-cream-warm);
  }

  .trust-item {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: var(--text-xs);
    color: var(--color-bark-light);
  }

  .trust-item svg {
    color: var(--color-sage);
  }

  /* Empty Cart */
  .cart-empty {
    text-align: center;
    padding: var(--space-20) var(--space-6);
  }

  .cart-empty-icon {
    margin-bottom: var(--space-6);
    color: var(--color-sage);
    opacity: 0.5;
    animation: float 4s ease-in-out infinite;
  }

  .cart-empty-title {
    font-family: var(--font-heading);
    font-size: var(--text-3xl);
    color: var(--color-forest);
    margin-bottom: var(--space-4);
  }

  .cart-empty-message {
    font-size: var(--text-lg);
    color: var(--color-bark-light);
    margin-bottom: var(--space-8);
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
</style>

{% schema %}
{
  "name": "Cart",
  "tag": "section",
  "class": "main-cart-section",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Your Cart"
    },
    {
      "type": "text",
      "id": "empty_title",
      "label": "Empty cart title",
      "default": "Your cart is empty"
    },
    {
      "type": "textarea",
      "id": "empty_message",
      "label": "Empty cart message",
      "default": "Looks like you haven't added any trees or shrubs yet. Start building your perfect landscape!"
    },
    {
      "type": "checkbox",
      "id": "show_note",
      "label": "Show order notes",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_trust_badges",
      "label": "Show trust badges",
      "default": true
    }
  ]
}
{% endschema %}
