{% comment %}
  Star Rating Component
  Displays a star rating with optional review count.

  Usage:
  {% render 'star-rating', rating: 4.5, count: 124, show_count: true %}

  Parameters:
  - rating: Number - Rating value 0-5 (required)
  - count: Number - Number of reviews (optional)
  - show_count: Boolean - Show review count (default: false)
  - max_stars: Number - Maximum stars to display (default: 5)
  - size: String - 'sm', 'md', 'lg' (default: 'sm')
{% endcomment %}

{%- liquid
  assign rating = rating | default: 0 | times: 1.0
  assign count = count | default: 0
  assign show_count = show_count | default: false
  assign max_stars = max_stars | default: 5
  assign size = size | default: 'sm'

  # Calculate full, half, and empty stars
  assign full_stars = rating | floor
  assign decimal = rating | modulo: 1
  assign has_half = false
  if decimal >= 0.25 and decimal < 0.75
    assign has_half = true
  elsif decimal >= 0.75
    assign full_stars = full_stars | plus: 1
  endif
  assign empty_stars = max_stars | minus: full_stars
  if has_half
    assign empty_stars = empty_stars | minus: 1
  endif
-%}

<div class="star-rating star-rating--{{ size }}" role="img" aria-label="{{ rating }} out of {{ max_stars }} stars{% if count > 0 %}, {{ count }} reviews{% endif %}">
  <div class="star-rating__stars" aria-hidden="true">
    {%- comment -%} Full stars {%- endcomment -%}
    {%- for i in (1..full_stars) -%}
      <svg class="star-rating__star star-rating__star--full" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    {%- endfor -%}

    {%- comment -%} Half star {%- endcomment -%}
    {%- if has_half -%}
      <svg class="star-rating__star star-rating__star--half" viewBox="0 0 24 24">
        <defs>
          <linearGradient id="half-star-{{ section.id }}-{{ forloop.index }}">
            <stop offset="50%" stop-color="currentColor"/>
            <stop offset="50%" stop-color="transparent"/>
          </linearGradient>
        </defs>
        <path fill="url(#half-star-{{ section.id }}-{{ forloop.index }})" stroke="currentColor" stroke-width="1.5" d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    {%- endif -%}

    {%- comment -%} Empty stars {%- endcomment -%}
    {%- for i in (1..empty_stars) -%}
      <svg class="star-rating__star star-rating__star--empty" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
      </svg>
    {%- endfor -%}
  </div>

  {%- if show_count and count > 0 -%}
    <span class="star-rating__count">({{ count }})</span>
  {%- endif -%}
</div>

<style>
  .star-rating {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
  }

  .star-rating__stars {
    display: flex;
    align-items: center;
    gap: 1px;
  }

  .star-rating__star {
    flex-shrink: 0;
  }

  .star-rating__star--full,
  .star-rating__star--half {
    color: var(--color-gold);
  }

  .star-rating__star--empty {
    color: var(--color-cream-warm);
    stroke: var(--color-sage);
  }

  .star-rating__count {
    font-size: var(--text-xs);
    font-weight: var(--weight-medium);
    color: var(--color-sage);
  }

  /* Size variants */
  .star-rating--sm .star-rating__star {
    width: 14px;
    height: 14px;
  }

  .star-rating--md .star-rating__star {
    width: 18px;
    height: 18px;
  }

  .star-rating--lg .star-rating__star {
    width: 24px;
    height: 24px;
  }

  .star-rating--lg .star-rating__count {
    font-size: var(--text-sm);
  }
</style>
